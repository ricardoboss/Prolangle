@implements IAsyncDisposable

@inject IJSRuntime JsRuntime

<pre class="snippet-game-code">
	<code class="@Language" @ref="_codeElement">
		@ChildContent
	</code>
</pre>

@code {
	private IJSObjectReference? _jsModule;

	[Parameter]
	public required RenderFragment ChildContent { get; set; }

	[Parameter]
	public string Language { get; set; } = "csharp";

	ElementReference _codeElement;

	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		if (firstRender)
		{
			_jsModule = await JsRuntime.InvokeAsync<IJSObjectReference>(
				"import", "./Components/CodeSnippet.razor.js");
		}

		if (_jsModule is not null)
			await _jsModule.InvokeVoidAsync("CodeSnippet.highlightSnippet", _codeElement);
	}

	async ValueTask IAsyncDisposable.DisposeAsync()
	{
		if (_jsModule is null)
			return;

		await _jsModule.DisposeAsync();
	}
}
